[{"id":"abe36278.d3a5e","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"9648297c.564688","type":"tab","label":"Databases","disabled":false,"info":""},{"id":"64c3c505.631b7c","type":"tab","label":"Website","disabled":false,"info":""},{"id":"18000974.c23df7","type":"tab","label":"Discovery","disabled":false,"info":""},{"id":"3bd1ba7.f516946","type":"mqtt-broker","z":"","name":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"d2b7de10.e07f8","type":"sqlitedb","z":"","db":"/home/pi/reference.db","mode":"RWC"},{"id":"667529e2.c47648","type":"sqlitedb","z":"","db":"/home/pi/data.db","mode":"RWC"},{"id":"de56088c.1cb958","type":"debug","z":"abe36278.d3a5e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":710,"y":140,"wires":[]},{"id":"ae2cfd14.bf776","type":"mqtt in","z":"abe36278.d3a5e","name":"","topic":"sensors/temperature/+","qos":"2","datatype":"auto","broker":"3bd1ba7.f516946","x":200,"y":100,"wires":[["8d8e860f.f7a2f8"]]},{"id":"67221d24.687c74","type":"sqlite","z":"9648297c.564688","mydb":"d2b7de10.e07f8","sqlquery":"fixed","sql":"INSERT INTO sensactref(name, types)\n    select 'DHT11' as name, 'TH' as types\n    union select 'BME280' as name, 'THP' as types\n    union select 'HCSR501' as name, 'M' as types\n    union select 'Button' as name, 'B' as types\n    union select 'TSL2561' as name, 'L' as types\n    union select 'HCSR04' as name, 'D' as types\n    union select 'CCS811' as name, 'CV' as types\n    union select 'MAX44009' as name, 'L' as types\n    union select 'MPU6050' as name, 'GA' as types\n    union select 'VEML6070' as name, 'U' as types\n    union select 'SI1145' as name, 'U' as types\n    union select 'MPR121' as name, 'E' as types\n    union select 'BMP280' as name, 'THPV' as types\n    union select 'TX20' as name, 'W' as types;","name":"fill reference.db table","x":360,"y":80,"wires":[["2f35eea0.f222e2"]]},{"id":"9aadd5db.cb9728","type":"comment","z":"9648297c.564688","name":"Use only for initial filling","info":"","x":360,"y":40,"wires":[]},{"id":"24ae0c5b.1e48a4","type":"comment","z":"9648297c.564688","name":"Aktoren fehlen noch - Namen und Typen überprüfen","info":"","x":370,"y":140,"wires":[]},{"id":"9ec291d1.7e545","type":"inject","z":"9648297c.564688","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":80,"wires":[["67221d24.687c74"]]},{"id":"2f35eea0.f222e2","type":"debug","z":"9648297c.564688","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":620,"y":80,"wires":[]},{"id":"4fccbbc0.5d6064","type":"sqlite","z":"9648297c.564688","mydb":"d2b7de10.e07f8","sqlquery":"fixed","sql":"\nSELECT * FROM sensactref;","name":"select * from reference table","x":360,"y":220,"wires":[["8274c144.76294","52e12fe8.da81a"]]},{"id":"23205fb0.5628d","type":"inject","z":"9648297c.564688","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":220,"wires":[["4fccbbc0.5d6064"]]},{"id":"8274c144.76294","type":"debug","z":"9648297c.564688","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":610,"y":220,"wires":[]},{"id":"5d0dc0ee.9fc8e","type":"sqlite","z":"9648297c.564688","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"INSERT INTO connections(IP, refid, category, types, curunit, curinterval, dispname, status, islogged, isnotifying) VALUES();","name":"exec msg.topic","x":780,"y":480,"wires":[["fec40cb8.a9607"]]},{"id":"c91e0e59.be0e2","type":"function","z":"9648297c.564688","name":"msg parts to topic","func":"var ip = msg.ip;\nvar ref = msg.refId;\nvar cat = msg.category;\nvar type = msg.types;\nvar curunit = msg.curunit;\nvar curinterval = msg.curinterval;\nvar dispname = msg.dispname;\nvar status = msg.refStatus;\nvar isLogged = msg.isLogged;\nvar isNotifying = msg.isNotifying;\n\nmsg.topic = \"INSERT INTO connections(IP, refid, category, types, curunit, curinterval, dispname, status, islogged, isnotifying) VALUES('\" + ip + \"', \" + ref + \", '\" + cat + \"', '\" + type + \"', '\" + curunit + \"', \" + curinterval + \", '\" + dispname + \"', '\" + status + \"', \" + isLogged + \", \" + isNotifying + \");\";\n\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":480,"wires":[["5d0dc0ee.9fc8e"]]},{"id":"72ed12f4.07468c","type":"inject","z":"9648297c.564688","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":480,"wires":[["c66d6b03.92d128"]]},{"id":"fec40cb8.a9607","type":"debug","z":"9648297c.564688","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1010,"y":480,"wires":[]},{"id":"c66d6b03.92d128","type":"change","z":"9648297c.564688","name":"","rules":[{"t":"set","p":"ip","pt":"msg","to":"192.168.1.3","tot":"str"},{"t":"set","p":"refId","pt":"msg","to":"100100201","tot":"str"},{"t":"set","p":"category","pt":"msg","to":"sensor","tot":"str"},{"t":"set","p":"types","pt":"msg","to":"DHT11","tot":"str"},{"t":"set","p":"curunit","pt":"msg","to":"CP","tot":"str"},{"t":"set","p":"curinterval","pt":"msg","to":"2000","tot":"num"},{"t":"set","p":"dispname","pt":"msg","to":"Badsensor","tot":"str"},{"t":"set","p":"refStatus","pt":"msg","to":"connected","tot":"str"},{"t":"set","p":"isLogged","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"isNotifying","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":480,"wires":[["c91e0e59.be0e2"]]},{"id":"52e12fe8.da81a","type":"link out","z":"9648297c.564688","name":"OUT select * from reference table","links":[],"x":575,"y":260,"wires":[]},{"id":"71403f62.82e7d","type":"link in","z":"9648297c.564688","name":"IN select * from reference table","links":[],"x":175,"y":260,"wires":[["4fccbbc0.5d6064"]]},{"id":"8d8e860f.f7a2f8","type":"function","z":"abe36278.d3a5e","name":"backup payload and extract refId","func":"msg.txpayload = msg.payload;\nmsg.payload = msg.topic.replace('sensors/temperature/','');\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":100,"wires":[["c9af79f3.2fd1d8","de56088c.1cb958"]]},{"id":"e7dda356.73405","type":"inject","z":"9648297c.564688","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":580,"wires":[["271ae820.9c0d68"]]},{"id":"ad7f61b0.24a68","type":"comment","z":"9648297c.564688","name":"Add row to connections table","info":"","x":200,"y":440,"wires":[]},{"id":"b53022ea.9154d","type":"comment","z":"9648297c.564688","name":"Read all from connections table","info":"","x":210,"y":540,"wires":[]},{"id":"271ae820.9c0d68","type":"template","z":"9648297c.564688","name":"select * from connections","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM connections;","output":"str","x":350,"y":580,"wires":[["a569cdbe.7cc5f"]]},{"id":"a569cdbe.7cc5f","type":"sqlite","z":"9648297c.564688","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"","name":"exec msg.topic","x":780,"y":580,"wires":[["7a713194.c5536","c07a7b68.1a65b8"]]},{"id":"7a713194.c5536","type":"link out","z":"9648297c.564688","name":"OUT select * from connections","links":[],"x":915,"y":620,"wires":[]},{"id":"100fd53d.97c78b","type":"link in","z":"9648297c.564688","name":"IN select * from connections","links":[],"x":175,"y":620,"wires":[["271ae820.9c0d68"]]},{"id":"adbf6b66.232bf8","type":"template","z":"9648297c.564688","name":"select * where refId matching","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM connections WHERE refid = {{payload}};","output":"str","x":360,"y":720,"wires":[["82fefd45.5c76e"]]},{"id":"9c828dcc.9de2a","type":"comment","z":"9648297c.564688","name":"Read specific from connections table","info":"","x":220,"y":680,"wires":[]},{"id":"82fefd45.5c76e","type":"sqlite","z":"9648297c.564688","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"","name":"exec msg.topic","x":780,"y":720,"wires":[["f8bbdfbd.a488d","1a4cfcee.3fcf13"]]},{"id":"ae4c8f89.2505a","type":"inject","z":"9648297c.564688","name":"","topic":"","payload":"100100200","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":720,"wires":[["adbf6b66.232bf8"]]},{"id":"b22f75e9.be4078","type":"link in","z":"9648297c.564688","name":"IN select * where refid matching","links":["c9af79f3.2fd1d8"],"x":175,"y":780,"wires":[["adbf6b66.232bf8"]]},{"id":"f8bbdfbd.a488d","type":"link out","z":"9648297c.564688","name":"OUT select * where refid matching","links":["54734feb.06789"],"x":915,"y":760,"wires":[]},{"id":"1a4cfcee.3fcf13","type":"debug","z":"9648297c.564688","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1010,"y":720,"wires":[]},{"id":"c07a7b68.1a65b8","type":"debug","z":"9648297c.564688","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1010,"y":580,"wires":[]},{"id":"c9af79f3.2fd1d8","type":"link out","z":"abe36278.d3a5e","name":"OUT sensors/temperature","links":["b22f75e9.be4078"],"x":675,"y":100,"wires":[]},{"id":"54734feb.06789","type":"link in","z":"abe36278.d3a5e","name":"IN sensors/temperature","links":["f8bbdfbd.a488d"],"x":155,"y":180,"wires":[["2374d383.443f3c"]]},{"id":"2374d383.443f3c","type":"change","z":"abe36278.d3a5e","name":"rearrange msg properties","rules":[{"t":"set","p":"topic","pt":"msg","to":"payload[0].refid","tot":"msg"},{"t":"set","p":"clientinfo","pt":"msg","to":"payload[0]","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"txpayload","tot":"msg"},{"t":"delete","p":"txpayload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":180,"wires":[["fda94a7a.488418"]]},{"id":"8762f095.8167c","type":"debug","z":"64c3c505.631b7c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":530,"y":1600,"wires":[]},{"id":"451485a4.eab36c","type":"uibuilder","z":"64c3c505.631b7c","name":"","topic":"","url":"uibuilder","fwdInMessages":false,"allowScripts":false,"allowStyles":false,"debugFE":false,"copyIndex":true,"template":"","filename":"uibuilder.appcache","format":"text","x":280,"y":1600,"wires":[["8762f095.8167c"],["788e773c.8fb308"]]},{"id":"c9c6bfbf.46ff5","type":"link in","z":"64c3c505.631b7c","name":"IN uibuilder","links":[],"x":75,"y":1600,"wires":[["451485a4.eab36c"]]},{"id":"621008f.0d01cf8","type":"sqlite","z":"9648297c.564688","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"SELECT * FROM T_100100200;","name":"","x":790,"y":920,"wires":[["fa238386.09169","178930ef.bdb96f"]]},{"id":"8c6e13e9.7cbd6","type":"inject","z":"9648297c.564688","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":920,"wires":[["96759ab.2a65d68"]]},{"id":"fa238386.09169","type":"debug","z":"9648297c.564688","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1010,"y":920,"wires":[]},{"id":"8c456ab2.f6c278","type":"comment","z":"9648297c.564688","name":"Write new value into T_<refid> table","info":"","x":220,"y":880,"wires":[]},{"id":"ca09667a.f409e8","type":"template","z":"9648297c.564688","name":"insert into T_<refId> new row","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"INSERT INTO T_{{topic}}(time, value) VALUES({{time}}, {{payload}});","output":"str","x":540,"y":920,"wires":[["621008f.0d01cf8","d03bb2c2.dcd5c"]]},{"id":"b12b7392.382ab","type":"debug","z":"abe36278.d3a5e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":750,"y":240,"wires":[]},{"id":"96759ab.2a65d68","type":"change","z":"9648297c.564688","name":"","rules":[{"t":"set","p":"time","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"20.9","tot":"num"},{"t":"set","p":"topic","pt":"msg","to":"100100200","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":920,"wires":[["ca09667a.f409e8"]]},{"id":"d03bb2c2.dcd5c","type":"debug","z":"9648297c.564688","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","x":610,"y":1000,"wires":[]},{"id":"ffa98f8e.096be","type":"sqlite","z":"9648297c.564688","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"SELECT * FROM T_100100200;","name":"","x":790,"y":1060,"wires":[["bf6ce7da.b793b8"]]},{"id":"df9de346.cdfb5","type":"comment","z":"9648297c.564688","name":"Read values from T_<refId> table","info":"","x":210,"y":1020,"wires":[]},{"id":"d2d2eb2e.f22708","type":"inject","z":"9648297c.564688","name":"","topic":"100100200","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":1060,"wires":[["b100b7ff.a86208"]]},{"id":"b100b7ff.a86208","type":"template","z":"9648297c.564688","name":"select * from T_<refId>","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SELECT * FROM T_{{topic}};","output":"str","x":560,"y":1060,"wires":[["ffa98f8e.096be"]]},{"id":"bf6ce7da.b793b8","type":"debug","z":"9648297c.564688","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1010,"y":1060,"wires":[]},{"id":"6603e3fb.95945c","type":"link in","z":"9648297c.564688","name":"IN insert into T_<refId>","links":["a4dd08cb.c04028"],"x":175,"y":960,"wires":[["ca09667a.f409e8"]]},{"id":"178930ef.bdb96f","type":"link out","z":"9648297c.564688","name":"OUT insert into T_<refId>","links":[],"x":935,"y":960,"wires":[]},{"id":"a4dd08cb.c04028","type":"link out","z":"abe36278.d3a5e","name":"OUT sensors/temperature arranged","links":["6603e3fb.95945c"],"x":695,"y":300,"wires":[]},{"id":"2927061a.b1beea","type":"comment","z":"abe36278.d3a5e","name":"Hier Zeit generieren","info":"","x":570,"y":240,"wires":[]},{"id":"fda94a7a.488418","type":"change","z":"abe36278.d3a5e","name":"","rules":[{"t":"set","p":"time","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":280,"wires":[["a4dd08cb.c04028","b12b7392.382ab"]]},{"id":"788e773c.8fb308","type":"debug","z":"64c3c505.631b7c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":510,"y":1660,"wires":[]},{"id":"3a64a7b8.378fe8","type":"uibuilder","z":"64c3c505.631b7c","name":"","topic":"","url":"deviceoverview","fwdInMessages":false,"allowScripts":false,"allowStyles":false,"debugFE":false,"copyIndex":true,"template":"","filename":"index.html","format":"text","x":800,"y":800,"wires":[[],["ae041155.93082"]]},{"id":"b3315e46.18a65","type":"uibuilder","z":"64c3c505.631b7c","name":"","topic":"","url":"devicesettings","fwdInMessages":false,"allowScripts":false,"allowStyles":false,"debugFE":false,"copyIndex":true,"template":"","filename":"index.html","format":"text","x":800,"y":1300,"wires":[["c9a7f8c2.6a75b8"],["5f1eb621.58bee8"]]},{"id":"f771d26d.6d3f9","type":"link out","z":"64c3c505.631b7c","name":"OUT dashboard ctrl","links":["b34d632c.33631"],"x":955,"y":400,"wires":[]},{"id":"b34d632c.33631","type":"link in","z":"64c3c505.631b7c","name":"IN dashboard ctrl","links":["f771d26d.6d3f9"],"x":35,"y":60,"wires":[["c3a3b75c.dc7538"]]},{"id":"c3a3b75c.dc7538","type":"switch","z":"64c3c505.631b7c","name":"ui ctrl","property":"uibuilderCtrl","propertyType":"msg","rules":[{"t":"eq","v":"client connect","vt":"str"},{"t":"eq","v":"ready for content","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":3,"x":130,"y":60,"wires":[["23ba3661.406f5a"],["23ba3661.406f5a"],["5426df27.57377"]]},{"id":"5426df27.57377","type":"debug","z":"64c3c505.631b7c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":270,"y":100,"wires":[]},{"id":"23ba3661.406f5a","type":"change","z":"64c3c505.631b7c","name":"","rules":[{"t":"delete","p":"uibuilderCtrl","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":60,"wires":[["8b07f23a.978cf"]]},{"id":"c44c4a6a.4b7f08","type":"comment","z":"64c3c505.631b7c","name":"Autosending on page load","info":"ctrl messages from uibuilder node are analysed.\n\nIf page is (re)loading, the flow downwards is triggered.\n\nSee here:\nhttps://github.com/TotallyInformation/node-red-contrib-uibuilder/wiki/How-to-send-data-when-a-client-connects-or-reloads-the-page","x":130,"y":20,"wires":[]},{"id":"a50781fb.ccf4a","type":"uibuilder","z":"64c3c505.631b7c","name":"","topic":"","url":"dashboard","fwdInMessages":false,"allowScripts":false,"allowStyles":false,"debugFE":false,"copyIndex":true,"template":"","filename":"index.html","format":"text","x":790,"y":360,"wires":[["c00dd040.610c5"],["f771d26d.6d3f9"]]},{"id":"e19cb8cd.5ded68","type":"comment","z":"64c3c505.631b7c","name":"Ablauf Zuordnung Dashboard mit db","info":"1. db read -> all IDs, all rows and cols\n2. analyse IDs, extract sensorID and measuring type\n3. check (in db) how many data points should be shown\n4. db read -> last x data points","x":700,"y":20,"wires":[]},{"id":"b04aa1bd.b7e8f","type":"sqlite","z":"64c3c505.631b7c","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"","name":"","x":810,"y":120,"wires":[["ca1c26f0.dc9a18"]]},{"id":"a7197f1c.4084c","type":"template","z":"64c3c505.631b7c","name":"select * from uilayout","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"select * from uilayout;","output":"str","x":580,"y":120,"wires":[["b04aa1bd.b7e8f"]]},{"id":"ca1c26f0.dc9a18","type":"function","z":"64c3c505.631b7c","name":"sort layout data","func":"msg.dashboardData = [];\n\nmsg.payload.forEach(function(item, index) {\n    var uiType = item.htmlid.split(\"-\")[0];\n    var measType = item.htmlid.split(\"-\")[1];\n    var deviceId = item.htmlid.split(\"-\")[2];\n    \n    msg.dashboardData.push({\n        htmlId : item.htmlid,\n        numberGroup : item.numbergroup,\n        numberItem : item.numberitem,\n        uiType : uiType,\n        measType : measType,\n        deviceId : deviceId\n    });\n\n});\n\nmsg.payload = msg.dashboardData;\n\nreturn msg;","outputs":1,"noerr":0,"x":1020,"y":120,"wires":[["28b9abe8.1f6f84"]]},{"id":"25243793.9c5f58","type":"sqlite","z":"64c3c505.631b7c","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"","name":"","x":810,"y":180,"wires":[["74549113.8cd55"]]},{"id":"86f97d9d.c0737","type":"debug","z":"64c3c505.631b7c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":770,"y":300,"wires":[]},{"id":"28b9abe8.1f6f84","type":"function","z":"64c3c505.631b7c","name":"forEach send select showndatapoints where refId matching","func":"msg.dashboardData.forEach(function(e) {\n    if (e.htmlId.includes(\"chart\")) {\n        node.send({\n        \"topic\": \"select showndatapoints from connections where refid = \" + e.deviceId.toString() + \";\",\n        \"dashboardData\": msg.dashboardData,\n        \"dashboardGroups\": msg.dashboardGroups,\n        \"_socketId\": msg._socketId\n        });\n    }\n});\n//return msg;","outputs":1,"noerr":0,"x":460,"y":180,"wires":[["25243793.9c5f58"]]},{"id":"74549113.8cd55","type":"function","z":"64c3c505.631b7c","name":"include shownDataPoints in dashboardData","func":"//extract device id from sql query / topic\nvar deviceId = msg.topic.split(\"= \")[1].split(\";\")[0];\n\nmsg.dashboardData.forEach(function(e) {\n    if (e.htmlId.includes(\"chart\") && e.htmlId.includes(deviceId)) {\n        e.shownDataPoints = msg.payload[0].showndatapoints;\n    }\n});\n\nreturn msg;","outputs":1,"noerr":0,"x":1110,"y":180,"wires":[["34b6f494.3bb2bc"]]},{"id":"34b6f494.3bb2bc","type":"function","z":"64c3c505.631b7c","name":"forEach send select datapoints","func":"msg.dashboardData.forEach(function(e) {\n    var tempTopic = \"\";\n    \n    if (e.htmlId.includes(\"chart\")) {\n        if (e.htmlId.includes(\"Hum\")) {\n            tempTopic = \"select * from H_\"+ e.deviceId.toString() + \" order by id desc limit \" + e.shownDataPoints + \";\";\n        }\n        else if (e.htmlId.includes(\"Temp\")) {\n            tempTopic = \"select * from T_\"+ e.deviceId.toString() + \" order by id desc limit \" + e.shownDataPoints + \";\";\n        }\n        //add more for other measurement types\n        \n        \n        node.send({\n            \"topic\": tempTopic,\n            \"curItem\": e.htmlId,\n            \"dashboardData\": msg.dashboardData,\n            \"dashboardGroups\": msg.dashboardGroups,\n            \"_socketId\": msg._socketId\n        });\n    }\n    else if (e.htmlId.includes(\"val\")) {\n        if (e.htmlId.includes(\"Hum\")) {\n            tempTopic = \"select * from H_\"+ e.deviceId.toString() + \" order by id desc limit 1;\";\n        }\n        else if (e.htmlId.includes(\"Temp\")) {\n            tempTopic = \"select * from T_\"+ e.deviceId.toString() + \" order by id desc limit 1;\";\n        }\n        //add more for other measurement types\n        \n        \n        node.send({\n            \"topic\": tempTopic,\n            \"curItem\": e.htmlId,\n            \"dashboardData\": msg.dashboardData,\n            \"dashboardGroups\": msg.dashboardGroups,\n            \"_socketId\": msg._socketId\n        });\n    }\n});\n\n//return msg;","outputs":1,"noerr":0,"x":550,"y":240,"wires":[["57a89905.7bab38"]]},{"id":"57a89905.7bab38","type":"sqlite","z":"64c3c505.631b7c","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"","name":"","x":810,"y":240,"wires":[["fa5f1583.ef8818"]]},{"id":"83bb930c.3c11b","type":"comment","z":"9648297c.564688","name":"Befehl zum Erstellen einer solchen Tabelle","info":"create table T_100100200(id integer not null primary key autoincrement, timehr text not null, timeunix integer not null, value real not null);","x":260,"y":1120,"wires":[]},{"id":"cff458e4.5140e8","type":"inject","z":"abe36278.d3a5e","name":"irgendwas vorher","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":460,"wires":[["735e30aa.de9ee","3ed18c81.1c7fc4","b8f91327.4254"]]},{"id":"e98285c2.4af818","type":"debug","z":"abe36278.d3a5e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":690,"y":460,"wires":[]},{"id":"735e30aa.de9ee","type":"moment","z":"abe36278.d3a5e","name":"","topic":"","input":"","inputType":"msg","inTz":"Europe/Berlin","adjAmount":0,"adjType":"days","adjDir":"add","format":"","locale":"de_DE","output":"","outputType":"msg","outTz":"Europe/Berlin","x":440,"y":460,"wires":[["e98285c2.4af818"]]},{"id":"2a033b62.9583b4","type":"comment","z":"abe36278.d3a5e","name":"Beispiel Zeitkonvertierung unix -> hr","info":"","x":250,"y":420,"wires":[]},{"id":"fa5f1583.ef8818","type":"function","z":"64c3c505.631b7c","name":"include DataPoints in dashboardData","func":"var setLastItem = false;\n\nmsg.dashboardData.forEach(function(e, i) {\n    //check if incoming data is intended for this element\n    if (msg.curItem == e.htmlId) {\n        //reverse data from db and save in dashboardData object\n        e.DataPoints = msg.payload.reverse();\n        \n        \n        //check if this element is the last possible match\n        if (i == (msg.dashboardData.length -1)) {\n            setLastItem = true;\n        }\n    }\n});\n\nif (setLastItem) {\n    msg.payload = \"lastItem\";\n}\nelse {\n    msg.payload = \"\";\n}\n\nmsg.topic = \"onLoadData\";\n\nreturn msg;","outputs":1,"noerr":0,"x":1090,"y":240,"wires":[["43af503d.40513"]]},{"id":"43af503d.40513","type":"rbe","z":"64c3c505.631b7c","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":470,"y":300,"wires":[["86f97d9d.c0737","a50781fb.ccf4a"]]},{"id":"8b07f23a.978cf","type":"template","z":"64c3c505.631b7c","name":"select * from uigroups","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"select * from uigroups;","output":"str","x":580,"y":60,"wires":[["ce7f3719.9e0a88"]]},{"id":"ce7f3719.9e0a88","type":"sqlite","z":"64c3c505.631b7c","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"","name":"","x":810,"y":60,"wires":[["b860a17.bcc086"]]},{"id":"b860a17.bcc086","type":"function","z":"64c3c505.631b7c","name":"sort group data","func":"msg.dashboardGroups = [];\n\nmsg.payload.forEach(function(item, index) {\n    var itemList = [];\n    \n    item.items.split('').forEach(function(element) {\n        if (element == \"V\") itemList.push(\"value\")\n        else if (element == \"C\") itemList.push(\"chart\")\n    });\n    \n    \n    \n    msg.dashboardGroups.push({\n        htmlId : item.htmlid,\n        name: item.name,\n        items: itemList\n    });\n\n});\n\nreturn msg;","outputs":1,"noerr":0,"x":1020,"y":60,"wires":[["a7197f1c.4084c"]]},{"id":"ae041155.93082","type":"link out","z":"64c3c505.631b7c","name":"OUT deviceoverview ctrl","links":["6cc9584a.fdaf08"],"x":955,"y":840,"wires":[]},{"id":"6cc9584a.fdaf08","type":"link in","z":"64c3c505.631b7c","name":"IN deviceoverview ctrl","links":["ae041155.93082"],"x":35,"y":720,"wires":[["f1ace5a5.683998"]]},{"id":"f1ace5a5.683998","type":"switch","z":"64c3c505.631b7c","name":"ui ctrl","property":"uibuilderCtrl","propertyType":"msg","rules":[{"t":"eq","v":"client connect","vt":"str"},{"t":"eq","v":"ready for content","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":3,"x":130,"y":720,"wires":[["bd5ed093.448fa"],["bd5ed093.448fa"],[]]},{"id":"bd5ed093.448fa","type":"change","z":"64c3c505.631b7c","name":"","rules":[{"t":"delete","p":"uibuilderCtrl","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":720,"wires":[["1e087322.c7683d"]]},{"id":"1e087322.c7683d","type":"template","z":"64c3c505.631b7c","name":"select * from connections","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"select * from connections;","output":"str","x":570,"y":720,"wires":[["9a6764d8.cb08c8"]]},{"id":"eeec3363.a8305","type":"comment","z":"64c3c505.631b7c","name":"Autosending on page load","info":"","x":130,"y":680,"wires":[]},{"id":"9a6764d8.cb08c8","type":"sqlite","z":"64c3c505.631b7c","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"","name":"","x":810,"y":720,"wires":[["c72101db.aba0b"]]},{"id":"c72101db.aba0b","type":"function","z":"64c3c505.631b7c","name":"sort overviewData","func":"msg.overviewData = [];\n\nmsg.payload.forEach(function(e,i) {\n    msg.overviewData.push({\n        deviceId: e.refid,\n        deviceIp: e.IP,\n        dispName: e.dispname,\n        deviceCategory: e.category,\n        deviceType: e.types,\n        isVisible: e.isvisible,\n        status: e.status\n    });\n});\n\nmsg.topic = \"onLoadData\";\n\nreturn msg;","outputs":1,"noerr":0,"x":1030,"y":720,"wires":[["3a64a7b8.378fe8","7477dc74.b20bd4"]]},{"id":"7477dc74.b20bd4","type":"debug","z":"64c3c505.631b7c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1150,"y":780,"wires":[]},{"id":"942e030a.b8c34","type":"mqtt in","z":"18000974.c23df7","name":"","topic":"discovery/device","qos":"2","datatype":"auto","broker":"3bd1ba7.f516946","x":100,"y":80,"wires":[["c64d4c44.5d562"]]},{"id":"456ef5b1.4c15ac","type":"mqtt out","z":"18000974.c23df7","name":"","topic":"discovery/master","qos":"","retain":"","broker":"3bd1ba7.f516946","x":1050,"y":320,"wires":[]},{"id":"8f06f8bc.fdc668","type":"comment","z":"18000974.c23df7","name":"Discovery of new sensors template","info":"","x":160,"y":40,"wires":[]},{"id":"eef970a4.5af1c","type":"template","z":"18000974.c23df7","name":"select * from sensactref","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"select * from sensactref;","output":"str","x":350,"y":200,"wires":[["b9723fea.150bc"]]},{"id":"a36c56a8.ec0b78","type":"change","z":"18000974.c23df7","name":"","rules":[{"t":"set","p":"txpayload","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":80,"wires":[["c5a81dd3.a991b"]]},{"id":"b9723fea.150bc","type":"sqlite","z":"18000974.c23df7","mydb":"d2b7de10.e07f8","sqlquery":"msg.topic","sql":"","name":"","x":600,"y":200,"wires":[["d5c158e.b5bdca8"]]},{"id":"a461bf7d.5b547","type":"function","z":"18000974.c23df7","name":"add to db with default vals","func":"msg.reference.forEach(function(element, index) {\n    if (element.name == msg.txpayload.name && !msg.ips.includes(msg.txpayload.ip)) {\n        msg.curRefId = msg.payload[0].refid+1;\n        \n        \n        msg.topic = \"insert into connections(IP, refid, category, types, curunit, curinterval, dispname, status, islogged, isnotifying, showndatapoints, isvisible) values('\" \n                    + msg.txpayload.ip + \"', \" + msg.curRefId + \", '\"+ element.category + \"', '\" + msg.txpayload.name + \"', '\" + element.defaultunits + \"', \" + element.defaultinterval + \", '\" + msg.txpayload.name\n                    + \"', 'connected', 1, 0, 10, 1);\";\n        return;\n    }\n});\n\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":260,"wires":[["c1f02dbe.992e5"]]},{"id":"403d50bb.1d7fc","type":"debug","z":"18000974.c23df7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":750,"y":440,"wires":[]},{"id":"c64d4c44.5d562","type":"json","z":"18000974.c23df7","name":"","property":"payload","action":"","pretty":false,"x":270,"y":80,"wires":[["a36c56a8.ec0b78"]]},{"id":"d83c44bc.bffa48","type":"template","z":"18000974.c23df7","name":"select highest refid from connections","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"select refid from connections order by refid desc limit 1;","output":"str","x":310,"y":260,"wires":[["1381b81c.cdfe18"]]},{"id":"1381b81c.cdfe18","type":"sqlite","z":"18000974.c23df7","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"","name":"","x":590,"y":260,"wires":[["a461bf7d.5b547"]]},{"id":"d5c158e.b5bdca8","type":"change","z":"18000974.c23df7","name":"","rules":[{"t":"set","p":"reference","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":200,"wires":[["d83c44bc.bffa48"]]},{"id":"c1f02dbe.992e5","type":"sqlite","z":"18000974.c23df7","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"","name":"","x":590,"y":320,"wires":[["bc542847.f3b9e8"]]},{"id":"5e7c4d26.41aa94","type":"comment","z":"18000974.c23df7","name":"trigger für Dashboard wg neuem Sensor hinzufügen!","info":"","x":890,"y":380,"wires":[]},{"id":"bc542847.f3b9e8","type":"change","z":"18000974.c23df7","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"curRefId","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":320,"wires":[["55e11370.3c2d4c","456ef5b1.4c15ac"]]},{"id":"55e11370.3c2d4c","type":"delay","z":"18000974.c23df7","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":380,"wires":[["403d50bb.1d7fc"]]},{"id":"c5a81dd3.a991b","type":"template","z":"18000974.c23df7","name":"select IP from connections","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"select IP from connections;","output":"str","x":340,"y":140,"wires":[["afd2d78a.53e4d8"]]},{"id":"afd2d78a.53e4d8","type":"sqlite","z":"18000974.c23df7","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"","name":"","x":590,"y":140,"wires":[["4d0d9e65.0f587"]]},{"id":"4d0d9e65.0f587","type":"function","z":"18000974.c23df7","name":"reordering array","func":"var tempArray = []\n\nmsg.payload.forEach(function(element, index) {\n    if (!tempArray.includes(element.IP)) {\n        tempArray.push(element.IP);\n    }\n});\n\nmsg.ips = tempArray;\nreturn msg;","outputs":1,"noerr":0,"x":800,"y":140,"wires":[["eef970a4.5af1c"]]},{"id":"c00dd040.610c5","type":"debug","z":"64c3c505.631b7c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1010,"y":360,"wires":[]},{"id":"4721308d.7440d","type":"comment","z":"64c3c505.631b7c","name":"Test page","info":"","x":100,"y":1540,"wires":[]},{"id":"fc9504f4.918af8","type":"comment","z":"64c3c505.631b7c","name":"Send new data / Update","info":"","x":120,"y":360,"wires":[]},{"id":"30cc976f.f39cb8","type":"comment","z":"64c3c505.631b7c","name":"Send new data / Update","info":"","x":120,"y":820,"wires":[]},{"id":"5f1eb621.58bee8","type":"link out","z":"64c3c505.631b7c","name":"OUT devicesettings ctrl","links":["42dd765a.dbe458"],"x":955,"y":1340,"wires":[]},{"id":"42dd765a.dbe458","type":"link in","z":"64c3c505.631b7c","name":"In devicesettings ctrl","links":["5f1eb621.58bee8"],"x":35,"y":1120,"wires":[["5ed20c86.c4b204"]]},{"id":"5ed20c86.c4b204","type":"switch","z":"64c3c505.631b7c","name":"ui ctrl","property":"uibuilderCtrl","propertyType":"msg","rules":[{"t":"eq","v":"client connect","vt":"str"},{"t":"eq","v":"ready for content","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":3,"x":130,"y":1120,"wires":[["474d24b7.3d53cc"],["474d24b7.3d53cc"],[]]},{"id":"474d24b7.3d53cc","type":"change","z":"64c3c505.631b7c","name":"","rules":[{"t":"delete","p":"uibuilderCtrl","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":1120,"wires":[["fc00718f.9f318"]]},{"id":"3ed18c81.1c7fc4","type":"moment","z":"abe36278.d3a5e","name":"","topic":"","input":"","inputType":"date","inTz":"Europe/Berlin","adjAmount":0,"adjType":"days","adjDir":"add","format":"unix","locale":"de_DE","output":"","outputType":"msg","outTz":"Europe/Berlin","x":440,"y":500,"wires":[["4ccd7522.b1c79c"]]},{"id":"b813fa7e.1fb868","type":"debug","z":"abe36278.d3a5e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1070,"y":500,"wires":[]},{"id":"4ccd7522.b1c79c","type":"change","z":"abe36278.d3a5e","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"uni","fromt":"str","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":500,"wires":[["71051c43.e776a4"]]},{"id":"b8f91327.4254","type":"debug","z":"abe36278.d3a5e","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":410,"y":540,"wires":[]},{"id":"71051c43.e776a4","type":"moment","z":"abe36278.d3a5e","name":"","topic":"","input":"","inputType":"msg","inTz":"Europe/Berlin","adjAmount":0,"adjType":"days","adjDir":"add","format":"","locale":"de_DE","output":"","outputType":"msg","outTz":"Europe/Berlin","x":880,"y":500,"wires":[["b813fa7e.1fb868"]]},{"id":"7c8d79bb.5eb0d8","type":"inject","z":"9648297c.564688","name":"","topic":"","payload":"100100200","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":1420,"wires":[["ea28cbb7.4935f8"]]},{"id":"7b74a248.af868c","type":"template","z":"9648297c.564688","name":"select humidity","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"select timehr,value from H_{{payload}};","output":"str","x":360,"y":1540,"wires":[["93d27080.9f612"]]},{"id":"93d27080.9f612","type":"sqlite","z":"9648297c.564688","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"","name":"","x":590,"y":1540,"wires":[["c665cbc3.114588"]]},{"id":"3c8ebf54.cc58d","type":"debug","z":"9648297c.564688","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":830,"y":1700,"wires":[]},{"id":"52365b6e.2c9dd4","type":"template","z":"9648297c.564688","name":"select temperature","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"select timehr,value from T_{{payload}};","output":"str","x":370,"y":1480,"wires":[["5939d67c.b09198"]]},{"id":"5939d67c.b09198","type":"sqlite","z":"9648297c.564688","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"","name":"","x":590,"y":1480,"wires":[["fab0f5f.a5c0808"]]},{"id":"fab0f5f.a5c0808","type":"csv","z":"9648297c.564688","name":"temp to csv","sep":",","hdrin":false,"hdrout":true,"multi":"one","ret":"\\r\\n","temp":"timehr,value","skip":"0","x":790,"y":1480,"wires":[["919867c0.4a29b8"]]},{"id":"c665cbc3.114588","type":"csv","z":"9648297c.564688","name":"hum to csv","sep":",","hdrin":false,"hdrout":true,"multi":"one","ret":"\\r\\n","temp":"timehr,value","skip":"0","x":790,"y":1540,"wires":[["a2255956.96c518"]]},{"id":"df076a40.8f9488","type":"file","z":"9648297c.564688","name":"","filename":"/home/pi/.node-red/uibuilder/devicesettings/src/data.zip","appendNewline":false,"createDir":false,"overwriteFile":"true","encoding":"none","x":620,"y":1600,"wires":[["3c8ebf54.cc58d"]]},{"id":"f3ad07d7.b0a9b8","type":"comment","z":"9648297c.564688","name":"CSV Test für Dateiausgabe","info":"momentaner Plan:\n1. Button in Settings, um db zu lesen und in csv mit standardnamen zu schreiben\n2. Wenn fertig, triggere Nachricht and uibuilder\n3. dort aktivieren des Downloadbuttons\n4. Download der Datei über Button","x":240,"y":1360,"wires":[]},{"id":"23d5ca8d.5060a6","type":"zip","z":"9648297c.564688","name":"","mode":"compress","filename":"/home/pi/data.zip","outasstring":false,"x":330,"y":1600,"wires":[["df076a40.8f9488"]]},{"id":"919867c0.4a29b8","type":"function","z":"9648297c.564688","name":"add to array","func":"msg.array = [];\n\nmsg.array.push({\n    filename: \"temperature.csv\",\n    payload: msg.payload\n});\n\nmsg.payload = msg.refId;\n\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":1540,"wires":[["7b74a248.af868c"]]},{"id":"a2255956.96c518","type":"function","z":"9648297c.564688","name":"add to array","func":"msg.array.push({\n    filename: \"humidity.csv\",\n    payload: msg.payload\n});\n\nmsg.payload = msg.array;\n\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":1600,"wires":[["23d5ca8d.5060a6"]]},{"id":"ea28cbb7.4935f8","type":"function","z":"9648297c.564688","name":"backup id","func":"msg.refId = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":240,"y":1420,"wires":[["52365b6e.2c9dd4"]]},{"id":"9fcfcba8.9450b8","type":"comment","z":"9648297c.564688","name":"Todo: trigger für Webseite, Download freizugeben","info":"","x":740,"y":1400,"wires":[]},{"id":"fc00718f.9f318","type":"template","z":"64c3c505.631b7c","name":"select * from connections","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"select * from connections;","output":"str","x":570,"y":1120,"wires":[["278b38a9.c92b18"]]},{"id":"278b38a9.c92b18","type":"sqlite","z":"64c3c505.631b7c","mydb":"667529e2.c47648","sqlquery":"msg.topic","sql":"","name":"","x":810,"y":1120,"wires":[["10052f07.6f7611"]]},{"id":"10052f07.6f7611","type":"function","z":"64c3c505.631b7c","name":"sort settingsInputData, forEach send lastmsgtime","func":"var settingsInputData = [];\n\nmsg.payload.forEach(function(e,i) {\n    settingsInputData.push({\n        deviceId: e.refid,\n        deviceIp: e.IP,\n        dispName: e.dispname,\n        deviceCategory: e.category,\n        deviceType: e.types,\n        isVisible: e.isvisible,\n        status: e.status,\n        interval: e.curinterval,\n        units: e.curunit,\n        shownDataPoints: e.showndatapoints,\n        isNotifying: e.isnotifying,\n        lastReceivedVal: e.lastmsgtime,\n        manControl: e.mancontrol,\n        linkedTo: e.linkedto,\n        threshold: e.threshold,\n        linkRule: e.linkrule,\n        linkedMeas: e.linkedMeas\n    });\n    \n    node.send({\n        payload: e.lastmsgtime,\n        topic: e.refid,\n        settingsInputData: settingsInputData,\n        dataLength: msg.payload.length\n    });\n});\n","outputs":1,"noerr":0,"x":1130,"y":1120,"wires":[["11e2699d.d9c186"]]},{"id":"11e2699d.d9c186","type":"moment","z":"64c3c505.631b7c","name":"","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Berlin","adjAmount":"0","adjType":"hours","adjDir":"add","format":"fromNow","locale":"en_EN","output":"payload","outputType":"msg","outTz":"Europe/Berlin","x":800,"y":1180,"wires":[["afd7ece8.5fc"]]},{"id":"afd7ece8.5fc","type":"function","z":"64c3c505.631b7c","name":"attach formatted lastmsgtime","func":"\nmsg.settingsInputData.forEach(function(element, index) {\n    if (element.deviceId == msg.topic) {\n        element.lastReceivedVal = msg.payload;\n    }\n});\n\nmsg.topic = \"onLoadData\";\n\nif (msg.settingsInputData.length == msg.dataLength) {\n    msg.payload = \"lastItem\";\n}\nelse {\n    msg.payload = \"\";\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1060,"y":1180,"wires":[["8cdb67ee.b74788"]]},{"id":"8cdb67ee.b74788","type":"rbe","z":"64c3c505.631b7c","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":630,"y":1240,"wires":[["d3e09a75.2a42e8","b3315e46.18a65"]]},{"id":"d3e09a75.2a42e8","type":"debug","z":"64c3c505.631b7c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":770,"y":1240,"wires":[]},{"id":"c9a7f8c2.6a75b8","type":"debug","z":"64c3c505.631b7c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1080,"y":1280,"wires":[]}]